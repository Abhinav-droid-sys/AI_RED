<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>RED AI - Login</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
    --red:#FF3B30;
    --red2:#FF6B6B;
    --bg:#060607;
    --glass:rgba(255,255,255,0.06);
    --glass-border:rgba(255,255,255,0.12);
    --muted:#9B9BA6;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
    height:100%;
    font-family:'Inter',system-ui,sans-serif;
    background:var(--bg);
    color:#fff;
    overflow:hidden;
}

/* BACKGROUND VIDEO */
.video-wrap{position:fixed;inset:0;z-index:0}
.video-bg{
    width:100%;
    height:100%;
    object-fit:cover;
    filter:brightness(.45) saturate(1.1);
}
.video-blur{
    position:absolute;
    inset:0;
    backdrop-filter:blur(8px);
    background:rgba(10,10,11,.35);
}
.bokeh-overlay{
    position:absolute;
    inset:0;
    background:
        radial-gradient(circle at 30% 20%,rgba(255,59,48,.15),transparent 45%),
        radial-gradient(circle at 70% 80%,rgba(255,107,107,.12),transparent 50%),
        linear-gradient(180deg,rgba(10,10,11,.6),rgba(10,10,11,.95));
}

/* LOGIN CARD */
.login-container{
    position:relative;
    z-index:2;
    min-height:100svh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:env(safe-area-inset-top) env(safe-area-inset-right)
            env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.login-card{
    width:100%;
    max-width:420px;
    margin:16px;
    padding:44px 30px;
    background:var(--glass);
    backdrop-filter:blur(24px) saturate(1.3);
    border:1px solid var(--glass-border);
    border-radius:24px;
    box-shadow:0 25px 45px -10px rgba(0,0,0,.5);
}

.brand{text-align:center;margin-bottom:12px}
.brand h1{
    font-size:36px;
    font-weight:800;
    background:linear-gradient(135deg,var(--red),var(--red2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.brand p{color:var(--muted)}

.form-group{margin-bottom:20px}
.form-group input{
    width:100%;
    padding:15px 18px;
    background:rgba(255,255,255,.08);
    border:1px solid var(--glass-border);
    border-radius:16px;
    color:#fff;
    font-size:16px;
}

.login-btn{
    width:100%;
    padding:16px;
    background:linear-gradient(135deg,var(--red),var(--red2));
    border:none;
    border-radius:16px;
    font-weight:600;
    cursor:pointer;
    color:#fff;
}

.divider{
    text-align:center;
    margin:26px 0;
    position:relative;
    color:var(--muted);
    font-size:14px;
}
.divider::before{
    content:"";
    position:absolute;
    top:50%;
    left:0;
    right:0;
    height:1px;
    background:var(--glass-border);
}
.divider span{
    background:var(--glass);
    padding:0 18px;
}

.google-btn{
    width:100%;
    padding:15px;
    background:rgba(255,255,255,.1);
    border:1px solid var(--glass-border);
    border-radius:16px;
    cursor:pointer;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}

.switch-mode{
    margin-top:16px;
    text-align:center;
    font-size:14px;
    color:var(--muted);
    cursor:pointer;
}
.switch-mode span{color:var(--red2);font-weight:600}

.error{
    margin-top:14px;
    text-align:center;
    color:#ff9a9a;
    font-size:13px;
    display:none;
}
</style>
</head>

<body>

<div class="video-wrap">
    <video class="video-bg" autoplay muted loop playsinline>
        <source src="/static/bg_particle.mp4" type="video/mp4">
    </video>
    <div class="video-blur"></div>
    <div class="bokeh-overlay"></div>
</div>

<div class="login-container">
<div class="login-card">

<div class="brand">
    <h1>RED</h1>
    <p id="modeTitle">AI Assistant</p>
</div>

<div class="form-group">
    <input type="email" id="email" placeholder="Email address">
</div>

<div class="form-group">
    <input type="password" id="password" placeholder="Password">
</div>

<button class="login-btn" id="loginBtn">
    <span id="btnText">Enter RED</span>
</button>

<div class="divider"><span>or</span></div>

<button class="google-btn" id="googleBtn">
    <i class="fab fa-google"></i> Continue with Google
</button>

<div class="switch-mode" id="switchMode">
    Don’t have an account? <span>Create one</span>
</div>

<div class="error" id="errorBox"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendEmailVerification,
    GoogleAuthProvider,
    signInWithPopup,
    signOut
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyDdWXUryACInTpa_BqZ2giTF8UYJFWUz-c",
    authDomain: "red-ai-ab571.firebaseapp.com",
    projectId: "red-ai-ab571",
    appId: "1:789433608850:web:b61b2e86570b093331544b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let isSignup = false;

const btnText = document.getElementById("btnText");
const switchMode = document.getElementById("switchMode");
const modeTitle = document.getElementById("modeTitle");
const errorBox = document.getElementById("errorBox");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const googleBtn = document.getElementById("googleBtn");

onAuthStateChanged(auth, async (user) => {
    if (!user || !user.emailVerified) return;
    localStorage.setItem("idToken", await user.getIdToken());
    localStorage.setItem("userId", user.uid);
    localStorage.setItem("userEmail", user.email || "");
    window.location.replace("/");
});

switchMode.onclick = () => {
    isSignup = !isSignup;
    errorBox.style.display = "none";
    if (isSignup) {
        btnText.textContent = "Create Account";
        switchMode.innerHTML = `Already have an account? <span>Sign in</span>`;
        modeTitle.textContent = "Verify once. Use forever.";
    } else {
        btnText.textContent = "Enter RED";
        switchMode.innerHTML = `Don’t have an account? <span>Create one</span>`;
        modeTitle.textContent = "AI Assistant";
    }
};

loginBtn.onclick = async () => {
    try {
        if (isSignup) {
            const cred = await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
            await sendEmailVerification(cred.user);
            errorBox.textContent = "Verification email sent. Verify and log in.";
            errorBox.style.display = "block";
            await signOut(auth);
            return;
        }

        const cred = await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
        if (!cred.user.emailVerified) {
            errorBox.textContent = "Please verify your email first.";
            errorBox.style.display = "block";
            await signOut(auth);
            return;
        }

        localStorage.setItem("idToken", await cred.user.getIdToken());
        localStorage.setItem("userId", cred.user.uid);
        localStorage.setItem("userEmail", cred.user.email || "");
        window.location.href = "/";
    } catch (err) {
        errorBox.textContent = err.message;
        errorBox.style.display = "block";
    }
};

googleBtn.onclick = async () => {
    try {
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        localStorage.setItem("idToken", await result.user.getIdToken());
        localStorage.setItem("userId", result.user.uid);
        localStorage.setItem("userEmail", result.user.email || "");
        window.location.href = "/";
    } catch (err) {
        errorBox.textContent = err.message || "Google sign-in failed.";
        errorBox.style.display = "block";
    }
};
</script>

</body>
</html>
