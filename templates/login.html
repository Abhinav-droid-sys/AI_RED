<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>RED AI - Login</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
    --red:#FF3B30;
    --red2:#FF6B6B;
    --bg:#060607;
    --glass:rgba(255,255,255,0.06);
    --glass-border:rgba(255,255,255,0.12);
    --muted:#9B9BA6;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
    height:100%;
    font-family:'Inter',system-ui,sans-serif;
    background:var(--bg);
    color:#fff;
    overflow:hidden;
}

/* BACKGROUND VIDEO */
.video-wrap{position:fixed;inset:0;z-index:0}
.video-bg{
    width:100%;
    height:100%;
    object-fit:cover;
    filter:brightness(.45) saturate(1.1);
}
.video-blur{
    position:absolute;
    inset:0;
    backdrop-filter:blur(8px);
    background:rgba(10,10,11,.35);
}
.bokeh-overlay{
    position:absolute;
    inset:0;
    background:
        radial-gradient(circle at 30% 20%,rgba(255,59,48,.15),transparent 45%),
        radial-gradient(circle at 70% 80%,rgba(255,107,107,.12),transparent 50%),
        linear-gradient(180deg,rgba(10,10,11,.6),rgba(10,10,11,.95));
}

/* LOGIN CARD */
.login-container{
    position:relative;
    z-index:2;
    min-height:100svh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:env(safe-area-inset-top) env(safe-area-inset-right)
            env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.login-card{
    width:100%;
    max-width:420px;
    margin:16px;
    padding:44px 30px;
    background:var(--glass);
    backdrop-filter:blur(24px) saturate(1.3);
    border:1px solid var(--glass-border);
    border-radius:24px;
    box-shadow:0 25px 45px -10px rgba(0,0,0,.5);
}

.brand{text-align:center;margin-bottom:12px}
.brand h1{
    font-size:36px;
    font-weight:800;
    background:linear-gradient(135deg,var(--red),var(--red2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.brand p{color:var(--muted)}
.greeting{
    margin:8px 0 18px;
    text-align:center;
}
.greeting-title{
    font-size:14px;
    color:#e7e7ef;
    margin-bottom:8px;
}
.email-chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.08);
    font-size:12px;
    color:#d7d7e2;
}
.email-chip i{
    color:#ffb3ae;
}

.form-group{margin-bottom:20px}
.form-group input{
    width:100%;
    padding:15px 18px;
    background:rgba(255,255,255,.08);
    border:1px solid var(--glass-border);
    border-radius:16px;
    color:#fff;
    font-size:16px;
}
.password-wrap{
    position:relative;
}
.password-wrap input{
    padding-right:48px;
}
.toggle-pass{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    border:none;
    background:none;
    color:#cfd0da;
    cursor:pointer;
    width:30px;
    height:30px;
    border-radius:8px;
}
.toggle-pass:hover{
    background:rgba(255,255,255,.08);
}
.caps-warning{
    margin-top:8px;
    color:#ffb9b9;
    font-size:12px;
    display:none;
}
.password-meta{
    margin-top:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
}
.strength{
    flex:1;
}
.strength-bar{
    width:100%;
    height:6px;
    border-radius:999px;
    background:rgba(255,255,255,.12);
    overflow:hidden;
}
.strength-fill{
    height:100%;
    width:0%;
    border-radius:999px;
    transition:width .18s ease, background .18s ease;
    background:#9B9BA6;
}
.strength-text{
    margin-top:6px;
    font-size:12px;
    color:var(--muted);
}
.forgot-link{
    font-size:12px;
    color:#ffb3ae;
    text-decoration:none;
    white-space:nowrap;
}
.forgot-link:hover{
    text-decoration:underline;
}

.login-btn{
    width:100%;
    padding:16px;
    background:linear-gradient(135deg,var(--red),var(--red2));
    border:none;
    border-radius:16px;
    font-weight:600;
    cursor:pointer;
    color:#fff;
}

.divider{
    text-align:center;
    margin:26px 0;
    position:relative;
    color:var(--muted);
    font-size:14px;
}
.divider::before{
    content:"";
    position:absolute;
    top:50%;
    left:0;
    right:0;
    height:1px;
    background:var(--glass-border);
}
.divider span{
    background:var(--glass);
    padding:0 18px;
}

.google-btn{
    width:100%;
    padding:15px;
    background:rgba(255,255,255,.1);
    border:1px solid var(--glass-border);
    border-radius:16px;
    cursor:pointer;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}

.switch-mode{
    margin-top:16px;
    text-align:center;
    font-size:14px;
    color:var(--muted);
    cursor:pointer;
}
.switch-mode span{color:var(--red2);font-weight:600}

.error{
    margin-top:14px;
    text-align:center;
    color:#ff9a9a;
    font-size:13px;
    display:none;
}
.trust-strip{
    margin-top:18px;
    padding-top:14px;
    border-top:1px solid rgba(255,255,255,.1);
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    justify-content:center;
}
.trust-item{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    color:#d9d9e2;
    background:rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.14);
    border-radius:999px;
    padding:6px 9px;
}
.trust-item i{
    color:#ffb3ae;
}
</style>
</head>

<body>

<div class="video-wrap">
    <video class="video-bg" autoplay muted loop playsinline>
        <source src="/static/bg_particle.mp4" type="video/mp4">
    </video>
    <div class="video-blur"></div>
    <div class="bokeh-overlay"></div>
</div>

<div class="login-container">
<div class="login-card">

<div class="brand">
    <h1>RED</h1>
    <p id="modeTitle">AI Assistant</p>
</div>

<div class="greeting">
    <div class="greeting-title" id="greetText">Welcome back</div>
    <div class="email-chip" id="emailChip" style="display:none;">
        <i class="fas fa-at"></i>
        <span id="rememberedEmail"></span>
    </div>
</div>

<div class="form-group">
    <input type="email" id="email" placeholder="Email address">
</div>

<div class="form-group">
    <div class="password-wrap">
        <input type="password" id="password" placeholder="Password">
        <button class="toggle-pass" id="togglePass" type="button" aria-label="Show password">
            <i class="far fa-eye"></i>
        </button>
    </div>
    <div class="caps-warning" id="capsWarning"><i class="fas fa-triangle-exclamation"></i> Caps Lock is on</div>
    <div class="password-meta">
        <div class="strength">
            <div class="strength-bar"><div class="strength-fill" id="strengthFill"></div></div>
            <div class="strength-text" id="strengthText">Password strength</div>
        </div>
        <a class="forgot-link" href="#" id="forgotLink">Forgot?</a>
    </div>
</div>

<button class="login-btn" id="loginBtn">
    <span id="btnText">Enter RED</span>
</button>

<div class="divider"><span>or</span></div>

<button class="google-btn" id="googleBtn">
    <i class="fab fa-google"></i> Continue with Google
</button>

<div class="switch-mode" id="switchMode">
    Don’t have an account? <span>Create one</span>
</div>

<div class="error" id="errorBox"></div>

<div class="trust-strip">
    <div class="trust-item"><i class="fas fa-shield-halved"></i> Encrypted Auth</div>
    <div class="trust-item"><i class="fas fa-user-check"></i> Verified Email</div>
    <div class="trust-item"><i class="fas fa-lock"></i> Privacy First</div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendEmailVerification,
    sendPasswordResetEmail,
    GoogleAuthProvider,
    signInWithPopup,
    signOut
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyDdWXUryACInTpa_BqZ2giTF8UYJFWUz-c",
    authDomain: "red-ai-ab571.firebaseapp.com",
    projectId: "red-ai-ab571",
    appId: "1:789433608850:web:b61b2e86570b093331544b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let isSignup = false;

const btnText = document.getElementById("btnText");
const switchMode = document.getElementById("switchMode");
const modeTitle = document.getElementById("modeTitle");
const errorBox = document.getElementById("errorBox");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const togglePass = document.getElementById("togglePass");
const capsWarning = document.getElementById("capsWarning");
const strengthFill = document.getElementById("strengthFill");
const strengthText = document.getElementById("strengthText");
const forgotLink = document.getElementById("forgotLink");
const greetText = document.getElementById("greetText");
const emailChip = document.getElementById("emailChip");
const rememberedEmail = document.getElementById("rememberedEmail");
const loginBtn = document.getElementById("loginBtn");
const googleBtn = document.getElementById("googleBtn");

function setGreeting(){
    const hour = new Date().getHours();
    if (hour < 12) greetText.textContent = "Good morning";
    else if (hour < 18) greetText.textContent = "Good afternoon";
    else greetText.textContent = "Good evening";
    const savedEmail = localStorage.getItem("userEmail") || "";
    if (savedEmail) {
        rememberedEmail.textContent = savedEmail;
        emailChip.style.display = "inline-flex";
        if (!emailInput.value) emailInput.value = savedEmail;
    }
}

function updateStrength() {
    const p = passwordInput.value || "";
    let score = 0;
    if (p.length >= 8) score++;
    if (/[A-Z]/.test(p) && /[a-z]/.test(p)) score++;
    if (/\d/.test(p)) score++;
    if (/[^A-Za-z0-9]/.test(p)) score++;
    const pct = (score / 4) * 100;
    strengthFill.style.width = `${pct}%`;
    if (score <= 1) {
        strengthFill.style.background = "#ff7a7a";
        strengthText.textContent = "Weak";
    } else if (score <= 2) {
        strengthFill.style.background = "#ffc46b";
        strengthText.textContent = "Medium";
    } else if (score === 3) {
        strengthFill.style.background = "#8fd58c";
        strengthText.textContent = "Strong";
    } else {
        strengthFill.style.background = "#57c66b";
        strengthText.textContent = "Very strong";
    }
}

setGreeting();
updateStrength();

togglePass.onclick = () => {
    const isHidden = passwordInput.type === "password";
    passwordInput.type = isHidden ? "text" : "password";
    togglePass.innerHTML = isHidden ? '<i class="far fa-eye-slash"></i>' : '<i class="far fa-eye"></i>';
};

passwordInput.addEventListener("keyup", (e) => {
    capsWarning.style.display = e.getModifierState && e.getModifierState("CapsLock") ? "block" : "none";
    updateStrength();
});
passwordInput.addEventListener("keydown", (e) => {
    capsWarning.style.display = e.getModifierState && e.getModifierState("CapsLock") ? "block" : "none";
});
passwordInput.addEventListener("blur", () => {
    capsWarning.style.display = "none";
});

forgotLink.onclick = async (e) => {
    e.preventDefault();
    try {
        const email = (emailInput.value || "").trim();
        if (!email) {
            errorBox.textContent = "Enter your email first, then tap Forgot.";
            errorBox.style.display = "block";
            return;
        }
        await sendPasswordResetEmail(auth, email);
        errorBox.textContent = "Password reset email sent.";
        errorBox.style.display = "block";
    } catch (err) {
        errorBox.textContent = err.message || "Unable to send reset email.";
        errorBox.style.display = "block";
    }
};

onAuthStateChanged(auth, async (user) => {
    if (!user || !user.emailVerified) return;
    localStorage.setItem("idToken", await user.getIdToken());
    localStorage.setItem("userId", user.uid);
    localStorage.setItem("userEmail", user.email || "");
    window.location.replace("/");
});

switchMode.onclick = () => {
    isSignup = !isSignup;
    errorBox.style.display = "none";
    if (isSignup) {
        btnText.textContent = "Create Account";
        switchMode.innerHTML = `Already have an account? <span>Sign in</span>`;
        modeTitle.textContent = "Verify once. Use forever.";
    } else {
        btnText.textContent = "Enter RED";
        switchMode.innerHTML = `Don’t have an account? <span>Create one</span>`;
        modeTitle.textContent = "AI Assistant";
    }
};

loginBtn.onclick = async () => {
    try {
        if (isSignup) {
            const cred = await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
            await sendEmailVerification(cred.user);
            errorBox.textContent = "Verification email sent. Verify and log in.";
            errorBox.style.display = "block";
            await signOut(auth);
            return;
        }

        const cred = await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
        if (!cred.user.emailVerified) {
            errorBox.textContent = "Please verify your email first.";
            errorBox.style.display = "block";
            await signOut(auth);
            return;
        }

        localStorage.setItem("idToken", await cred.user.getIdToken());
        localStorage.setItem("userId", cred.user.uid);
        localStorage.setItem("userEmail", cred.user.email || "");
        window.location.href = "/";
    } catch (err) {
        errorBox.textContent = err.message;
        errorBox.style.display = "block";
    }
};

googleBtn.onclick = async () => {
    try {
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        localStorage.setItem("idToken", await result.user.getIdToken());
        localStorage.setItem("userId", result.user.uid);
        localStorage.setItem("userEmail", result.user.email || "");
        window.location.href = "/";
    } catch (err) {
        errorBox.textContent = err.message || "Google sign-in failed.";
        errorBox.style.display = "block";
    }
};
</script>

</body>
</html>
