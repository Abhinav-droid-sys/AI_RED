<!-- AUTH-GUARD-TEST -->

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>RED AI üê¶‚Äçüî•</title>

<meta name="theme-color" content="#0A0A0B" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- ===== SYNTAX HIGHLIGHTING (ADD ONLY) ===== -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

<style>
/* ===== ORIGINAL STYLES (UNCHANGED) ===== */
:root{
  --red:#FF3B30;
  --red2:#FF6B6B;
  --bg:#060607;
  --glass:rgba(255,255,255,0.06);
  --glass-border:rgba(255,255,255,0.12);
  --muted:#9B9BA6;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:white;
  overflow:auto;
}

/* ================= BACKGROUND ================= */
.bg-wrap{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  overflow:hidden;
}

.bg-layer{
  position:absolute;
  inset:-10%;
  background-size:cover;
  background-position:center;
  filter:blur(28px) brightness(0.38) saturate(1.1);
  opacity:0;
  transform:scale(1.04);
  transition:opacity 900ms ease, transform 900ms ease;
}
.bg-layer.visible{
  opacity:1;
  transform:scale(1);
}

.bg-hue{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,59,48,0.12), transparent 45%),
    linear-gradient(180deg, rgba(10,10,11,0.4), rgba(10,10,11,0.85));
  mix-blend-mode:overlay;
}

/* ================= APP ================= */
.app{
  position:relative;
  z-index:2;
  max-width:980px;
  margin:14px auto;
  height:calc(100dvh - 28px);
  display:flex;
  flex-direction:column;
  gap:12px;
  padding:12px;
}

/* ================= HEADER ================= */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 18px;
  border-radius:16px;
  background:var(--glass);
  backdrop-filter:blur(18px) saturate(1.2);
  border:1px solid var(--glass-border);
}

.brand{
  font-size:20px;
  font-weight:800;
  background:linear-gradient(135deg,var(--red),var(--red2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.icon-btn{
  background:none;
  border:none;
  color:white;
  font-size:20px;
  cursor:pointer;
  margin-left:14px;
}

/* ================= CHAT BOX ================= */
.chat-box{
  flex:1;
  display:flex;
  flex-direction:column;
  border-radius:18px;
  background:var(--glass);
  backdrop-filter:blur(20px) saturate(1.15);
  border:1px solid var(--glass-border);
  overflow:hidden;
}

.messages{
  flex:1;
  padding:18px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.msg{ display:flex; max-width:85%; }
.msg.user{ align-self:flex-end; }

.bubble{
  padding:12px 16px;
  border-radius:16px;
  line-height:1.45;
  font-size:15px;
}
.bubble.user{
  background:linear-gradient(135deg,var(--red),var(--red2));
  border-bottom-right-radius:6px;
}
.bubble.bot{
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.14);
  border-bottom-left-radius:6px;
}

/* ===== INLINE CODE (ADD ONLY) ===== */
.inline-code{
  font-family:monospace;
  background:rgba(255,255,255,0.12);
  padding:2px 6px;
  border-radius:6px;
  font-size:13px;
}

/* ===== CODE BLOCK (ADD ONLY) ===== */
.code-block{
  margin-top:8px;
  border-radius:10px;
  overflow:hidden;
  background:#1e1e1e;
  border:1px solid rgba(255,255,255,0.14);
}

.code-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:6px 10px;
  font-size:12px;
  font-family:monospace;
  color:var(--muted);
}

.code-header button{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  margin-left:8px;
}

.code-block pre{
  margin:0;
  padding:12px;
  overflow-x:auto;
  font-size:13px;
}
</style>
</head>

<body>

<script>
  const idToken = localStorage.getItem("idToken");
  if (!idToken) window.location.href = "/login";
</script>

<div class="bg-wrap">
  <div id="bgA" class="bg-layer"></div>
  <div id="bgB" class="bg-layer"></div>
  <div class="bg-hue"></div>
</div>

<div class="app">

<div class="header">
  <div class="brand">RED</div>
  <div>
    <button class="icon-btn" onclick="toggleSheet()">
      <i class="fas fa-layer-group"></i>
    </button>
    <button class="icon-btn" id="logoutBtn">
      <i class="fas fa-right-from-bracket"></i>
    </button>
  </div>
</div>

<div class="chat-box">
  <div class="messages" id="messages">
    <div class="msg">
      <div class="bubble bot">üî• Welcome to RED. Ask me anything.</div>
    </div>
  </div>

  <div class="input-wrap">
    <div class="input-row">
      <textarea id="input" rows="1" placeholder="Ask RED..."></textarea>
      <button class="send" onclick="sendMessage()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

</div>

<script>
/* ===== ADDITIVE HELPERS ONLY ===== */
function escapeHtml(t){
  return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

function copyCode(btn){
  const c=btn.closest(".code-block").querySelector("code").innerText;
  navigator.clipboard.writeText(c);
  btn.innerText="Copied ‚úì";
  setTimeout(()=>btn.innerText="Copy",1200);
}

function runCode(btn){
  const block=btn.closest(".code-block");
  const lang=block.dataset.lang;
  const code=block.querySelector("code").innerText;
  if(lang==="javascript"){
    try{ eval(code); alert("JS executed"); }
    catch(e){ alert(e.message); }
  }else{
    alert("Run supported only for JavaScript");
  }
}

function renderBotMessage(text){
  text=text.replace(/`([^`]+)`/g,'<span class="inline-code">$1</span>');
  const r=/```(\w+)?\n([\s\S]*?)```/g;
  let h=text.replace(r,(m,l,c)=>`
    <div class="code-block" data-lang="${(l||"text").toLowerCase()}">
      <div class="code-header">
        <span>${l||"code"}</span>
        <div>
          <button onclick="copyCode(this)">Copy</button>
          <button onclick="runCode(this)">Run</button>
        </div>
      </div>
      <pre><code class="language-${l||"text"}">${escapeHtml(c)}</code></pre>
    </div>
  `);
  return h.replace(/\n/g,"<br>");
}

/* ===== EXISTING CHAT (MINIMAL TOUCH) ===== */
function addMsg(text,role){
  const w=document.createElement("div");
  w.className="msg "+(role==="user"?"user":"");
  const b=document.createElement("div");
  b.className="bubble "+(role==="user"?"user":"bot");
  if(role==="bot"){
    b.innerHTML=renderBotMessage(text);
    setTimeout(()=>Prism.highlightAllUnder(b),0);
  }else{
    b.innerText=text;
  }
  w.appendChild(b);
  messages.appendChild(w);
  messages.scrollTop=messages.scrollHeight;
}
</script>

</body>
</html>
