<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>RED â€” AI Assistant</title>

  <!-- Theme -->
  <meta name="theme-color" content="#FF3B30" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root{
      --red:#FF3B30;
      --bg:#060607;
      --card:#0F0F12;
      --muted:#9B9BA6;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:Inter, system-ui, sans-serif;
      background:var(--bg);
      color:white;
      height:100dvh;
      overflow:auto;
    }

    /* ================= HEADER ================= */
    .header{
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      background:rgba(6,6,7,0.9);
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .brand{
      font-weight:800;
      font-size:20px;
      color:var(--red);
    }
    .menu-btn{
      background:none;
      border:none;
      color:white;
      font-size:20px;
      cursor:pointer;
    }

    /* ================= CHAT ================= */
    .chat{
      display:flex;
      flex-direction:column;
      height:calc(100dvh - 64px);
    }

    .messages{
      flex:1;
      overflow-y:auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:14px;
      -webkit-overflow-scrolling:touch;
    }

    .msg{
      display:flex;
      max-width:90%;
    }
    .msg.user{
      align-self:flex-end;
    }

    .bubble{
      padding:12px 14px;
      border-radius:14px;
      font-size:15px;
      line-height:1.4;
      word-wrap:break-word;
    }
    .bubble.user{
      background:var(--red);
      color:white;
      border-bottom-right-radius:4px;
    }
    .bubble.bot{
      background:var(--card);
      border:1px solid rgba(255,255,255,0.06);
      border-bottom-left-radius:4px;
    }

    /* ================= INPUT ================= */
    .input-wrap{
      position:sticky;
      bottom:0;
      padding:12px;
      background:var(--bg);
      border-top:1px solid rgba(255,255,255,0.06);
    }
    .input-row{
      display:flex;
      gap:10px;
      background:var(--card);
      border-radius:12px;
      padding:10px;
    }
    textarea{
      flex:1;
      resize:none;
      background:none;
      border:none;
      outline:none;
      color:white;
      font-size:15px;
      max-height:140px;
    }
    .send{
      background:var(--red);
      border:none;
      border-radius:10px;
      width:44px;
      height:44px;
      color:white;
      font-size:18px;
      cursor:pointer;
    }

    /* ================= HISTORY SHEET ================= */
    .sheet{
      position:fixed;
      left:0;
      bottom:0;
      width:100%;
      height:85dvh;
      background:#0C0C0F;
      transform:translateY(100%);
      transition:transform 280ms ease;
      border-radius:18px 18px 0 0;
      z-index:20;
      display:flex;
      flex-direction:column;
    }
    .sheet.open{
      transform:translateY(0);
    }
    .sheet-header{
      padding:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .sheet-header h3{
      margin:0;
      font-size:16px;
    }
    .sheet-list{
      flex:1;
      overflow:auto;
      padding:12px;
    }
    .chat-item{
      padding:12px;
      border-radius:10px;
      background:rgba(255,255,255,0.03);
      margin-bottom:8px;
      cursor:pointer;
    }
    .chat-item:hover{
      background:rgba(255,255,255,0.06);
    }

    /* ================= DESKTOP ================= */
    @media (min-width: 900px){
      body{
        max-width:900px;
        margin:auto;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div class="header">
    <div class="brand">RED</div>
    <button class="menu-btn" onclick="toggleSheet()">
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <!-- CHAT -->
  <div class="chat">
    <div class="messages" id="messages">
      <div class="msg">
        <div class="bubble bot">
          ðŸ‘‹ Hi! Iâ€™m RED. Ask me anything.
        </div>
      </div>
    </div>

    <div class="input-wrap">
      <div class="input-row">
        <textarea id="input" rows="1" placeholder="Type your message..."></textarea>
        <button class="send" onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- HISTORY SHEET -->
  <div class="sheet" id="sheet">
    <div class="sheet-header">
      <h3>Chats</h3>
      <button class="menu-btn" onclick="toggleSheet()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="sheet-list" id="chatList">
      <div class="chat-item">New Chat</div>
    </div>
  </div>

  <script>
    const sheet = document.getElementById("sheet");
    const messages = document.getElementById("messages");
    const input = document.getElementById("input");

    function toggleSheet(){
      sheet.classList.toggle("open");
    }

    input.addEventListener("input", ()=>{
      input.style.height = "auto";
      input.style.height = Math.min(input.scrollHeight,140)+"px";
    });

    async function sendMessage(){
      const text = input.value.trim();
      if(!text) return;

      addMsg(text,"user");
      input.value="";
      input.style.height="auto";

      addMsg("...", "bot");

      try{
        const res = await fetch("/api/chat",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({
            prompt:text,
            session_id:"mobile",
            is_incognito:false,
            history:[]
          })
        });
        const data = await res.json();
        removeTyping();
        addMsg(data.response || "Error", "bot");
      }catch{
        removeTyping();
        addMsg("Network error.", "bot");
      }
    }

    function addMsg(text,role){
      const wrap = document.createElement("div");
      wrap.className = "msg " + (role==="user"?"user":"");
      const bubble = document.createElement("div");
      bubble.className = "bubble " + (role==="user"?"user":"bot");
      bubble.innerText = text;
      wrap.appendChild(bubble);
      messages.appendChild(wrap);
      messages.scrollTop = messages.scrollHeight;
    }

    function removeTyping(){
      const last = messages.lastChild;
      if(last && last.innerText==="..."){
        last.remove();
      }
    }
  </script>
</body>
</html>
